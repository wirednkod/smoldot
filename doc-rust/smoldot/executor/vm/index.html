<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="General-purpose WebAssembly virtual machine."><title>smoldot::executor::vm - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-ba5701c5741a7b69.css" id="mainThemeStyle"><div id="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="smoldot" data-themes="" data-resource-suffix="" data-rustdoc-version="1.70.0 (90c541806 2023-05-31)" data-search-js="search-e077946657036a58.js" data-settings-js="settings-298e1ea74db45b39.js" data-settings-css="settings-7bfb4c59cc6bc502.css" data-theme-light-css="light-0f8c037637f9eb3e.css" data-theme-dark-css="dark-1097f8e92a01e3cf.css" data-theme-ayu-css="ayu-614652228113ac93.css" ></div><script src="../../../static.files/storage-62ce34ea385b278a.js"></script><script defer src="../../../static.files/main-f61008743c98d196.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../../../static.files/light-0f8c037637f9eb3e.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../../../static.files/dark-1097f8e92a01e3cf.css"><link rel="stylesheet" href="../../../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../../smoldot/index.html"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../../smoldot/index.html"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Module vm</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../../index.html">smoldot</a>::<wbr><a href="../index.html">executor</a>::<wbr><a class="mod" href="#">vm</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../../src/smoldot/executor/vm.rs.html#18-1257">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>General-purpose WebAssembly virtual machine.</p>
<p>Contains code related to running a WebAssembly virtual machine. Contrary to
(<code>HostVm</code>)<a href="../host/enum.HostVm.html" title="enum smoldot::executor::host::HostVm"><code>super::host::HostVm</code></a>, this module isn’t aware of any of the host
functions available to Substrate runtimes. It only contains the code required to run a virtual
machine, with some adjustments explained below.</p>
<h2 id="usage"><a href="#usage">Usage</a></h2>
<p>Call <a href="struct.VirtualMachinePrototype.html#method.new" title="associated function smoldot::executor::vm::VirtualMachinePrototype::new"><code>VirtualMachinePrototype::new</code></a> in order to parse and/or compile some WebAssembly code.
One of the parameters of this function is a function that is passed the name of functions
imported by the Wasm code, and must return an opaque <code>usize</code>. This <code>usize</code> doesn’t have any
meaning, but will later be passed back to the user through <a href="enum.ExecOutcome.html#variant.Interrupted.field.id" title="field smoldot::executor::vm::ExecOutcome::id"><code>ExecOutcome::Interrupted::id</code></a>
when the corresponding function is called.</p>
<p>Use <a href="struct.VirtualMachinePrototype.html#method.prepare" title="method smoldot::executor::vm::VirtualMachinePrototype::prepare"><code>VirtualMachinePrototype::prepare</code></a> then <a href="struct.Prepare.html#method.start" title="method smoldot::executor::vm::Prepare::start"><code>Prepare::start</code></a> in order to start executing
a function exported through an <code>(export)</code> statement.</p>
<p>Call <a href="struct.VirtualMachine.html#method.run" title="method smoldot::executor::vm::VirtualMachine::run"><code>VirtualMachine::run</code></a> on the <a href="struct.VirtualMachine.html" title="struct smoldot::executor::vm::VirtualMachine"><code>VirtualMachine</code></a> returned by <code>start</code> in order to run the
WebAssembly code. The <code>run</code> method returns either if the function being called returns, or if
the WebAssembly code calls a host function. In the latter case, <a href="enum.ExecOutcome.html#variant.Interrupted" title="variant smoldot::executor::vm::ExecOutcome::Interrupted"><code>ExecOutcome::Interrupted</code></a>
is returned and the virtual machine is now paused. Once the logic of the host function has
been executed, call <code>run</code> again, passing the return value of that host function.</p>
<h2 id="about-imported-vs-exported-memory"><a href="#about-imported-vs-exported-memory">About imported vs exported memory</a></h2>
<p>WebAssembly supports, in theory, addressing multiple different memory objects. The WebAssembly
module can declare memory in two ways:</p>
<ul>
<li>Either by exporting a memory object in the <code>(export)</code> section under the name <code>memory</code>.</li>
<li>Or by importing a memory object in its <code>(import)</code> section.</li>
</ul>
<p>The virtual machine in this module supports both variants. However, no more than one memory
object can be exported or imported, and it is illegal to not use any memory.</p>
<p>The first variant used to be the default model when compiling to WebAssembly, but the second
variant (importing memory objects) is preferred nowadays.</p>
<h2 id="wasm-features"><a href="#wasm-features">Wasm features</a></h2>
<p>The WebAssembly specification is a moving one. The specification as it was when it launched
in 2017 is commonly referred to as “the MVP” (minimum viable product). Since then, various
extensions have been added to the WebAssembly format.</p>
<p>The code in this module, however, doesn’t allow any of the feature that were added post-MVP.
Trying to use WebAssembly code that uses one of these features will result in an error.</p>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.Config.html" title="struct smoldot::executor::vm::Config">Config</a></div><div class="desc docblock-short">Configuration to pass to <a href="struct.VirtualMachinePrototype.html#method.new" title="associated function smoldot::executor::vm::VirtualMachinePrototype::new"><code>VirtualMachinePrototype::new</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.HeapPages.html" title="struct smoldot::executor::vm::HeapPages">HeapPages</a></div><div class="desc docblock-short">Number of heap pages available to the Wasm code.</div></li><li><div class="item-name"><a class="struct" href="struct.OutOfBoundsError.html" title="struct smoldot::executor::vm::OutOfBoundsError">OutOfBoundsError</a></div><div class="desc docblock-short">Error while reading memory.</div></li><li><div class="item-name"><a class="struct" href="struct.Prepare.html" title="struct smoldot::executor::vm::Prepare">Prepare</a></div></li><li><div class="item-name"><a class="struct" href="struct.Signature.html" title="struct smoldot::executor::vm::Signature">Signature</a></div><div class="desc docblock-short">Low-level Wasm function signature.</div></li><li><div class="item-name"><a class="struct" href="struct.Trap.html" title="struct smoldot::executor::vm::Trap">Trap</a></div><div class="desc docblock-short">Opaque error that happened during execution, such as an <code>unreachable</code> instruction.</div></li><li><div class="item-name"><a class="struct" href="struct.UnsupportedTypeError.html" title="struct smoldot::executor::vm::UnsupportedTypeError">UnsupportedTypeError</a></div><div class="desc docblock-short">Error used in the conversions between VM implementation and the public API.</div></li><li><div class="item-name"><a class="struct" href="struct.VirtualMachine.html" title="struct smoldot::executor::vm::VirtualMachine">VirtualMachine</a></div></li><li><div class="item-name"><a class="struct" href="struct.VirtualMachinePrototype.html" title="struct smoldot::executor::vm::VirtualMachinePrototype">VirtualMachinePrototype</a></div><div class="desc docblock-short">Virtual machine ready to start executing a function.</div></li></ul><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.ExecHint.html" title="enum smoldot::executor::vm::ExecHint">ExecHint</a></div><div class="desc docblock-short">Hint used by the implementation to decide which kind of virtual machine to use.</div></li><li><div class="item-name"><a class="enum" href="enum.ExecOutcome.html" title="enum smoldot::executor::vm::ExecOutcome">ExecOutcome</a></div><div class="desc docblock-short">Outcome of the <a href="struct.VirtualMachine.html#method.run" title="method smoldot::executor::vm::VirtualMachine::run"><code>run</code></a> function.</div></li><li><div class="item-name"><a class="enum" href="enum.GlobalValueErr.html" title="enum smoldot::executor::vm::GlobalValueErr">GlobalValueErr</a></div><div class="desc docblock-short">Error that can happen when calling <a href="struct.VirtualMachinePrototype.html#method.global_value" title="method smoldot::executor::vm::VirtualMachinePrototype::global_value"><code>VirtualMachinePrototype::global_value</code></a>.</div></li><li><div class="item-name"><a class="enum" href="enum.NewErr.html" title="enum smoldot::executor::vm::NewErr">NewErr</a></div><div class="desc docblock-short">Error that can happen when initializing a <a href="struct.VirtualMachinePrototype.html" title="struct smoldot::executor::vm::VirtualMachinePrototype"><code>VirtualMachinePrototype</code></a>.</div></li><li><div class="item-name"><a class="enum" href="enum.RunErr.html" title="enum smoldot::executor::vm::RunErr">RunErr</a></div><div class="desc docblock-short">Error that can happen when resuming the execution of a function.</div></li><li><div class="item-name"><a class="enum" href="enum.StartErr.html" title="enum smoldot::executor::vm::StartErr">StartErr</a></div><div class="desc docblock-short">Error that can happen when calling <a href="struct.Prepare.html#method.start" title="method smoldot::executor::vm::Prepare::start"><code>Prepare::start</code></a>.</div></li><li><div class="item-name"><a class="enum" href="enum.ValueType.html" title="enum smoldot::executor::vm::ValueType">ValueType</a></div><div class="desc docblock-short">Type of a value passed as parameter or returned by a function.</div></li><li><div class="item-name"><a class="enum" href="enum.WasmValue.html" title="enum smoldot::executor::vm::WasmValue">WasmValue</a></div><div class="desc docblock-short">Value that a Wasm function can accept or produce.</div></li></ul></section></div></main></body></html>