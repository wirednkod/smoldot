<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Finalized block header, plus tree of authenticated non-finalized block headers."><title>smoldot::chain::blocks_tree - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-ba5701c5741a7b69.css" id="mainThemeStyle"><div id="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="smoldot" data-themes="" data-resource-suffix="" data-rustdoc-version="1.70.0 (90c541806 2023-05-31)" data-search-js="search-e077946657036a58.js" data-settings-js="settings-298e1ea74db45b39.js" data-settings-css="settings-7bfb4c59cc6bc502.css" data-theme-light-css="light-0f8c037637f9eb3e.css" data-theme-dark-css="dark-1097f8e92a01e3cf.css" data-theme-ayu-css="ayu-614652228113ac93.css" ></div><script src="../../../static.files/storage-62ce34ea385b278a.js"></script><script defer src="../../../static.files/main-f61008743c98d196.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../../../static.files/light-0f8c037637f9eb3e.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../../../static.files/dark-1097f8e92a01e3cf.css"><link rel="stylesheet" href="../../../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../../smoldot/index.html"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../../smoldot/index.html"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Module blocks_tree</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#reexports">Re-exports</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../../index.html">smoldot</a>::<wbr><a href="../index.html">chain</a>::<wbr><a class="mod" href="#">blocks_tree</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../../src/smoldot/chain/blocks_tree.rs.html#18-671">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Finalized block header, plus tree of authenticated non-finalized block headers.</p>
<p>This module provides the <a href="struct.NonFinalizedTree.html" title="struct smoldot::chain::blocks_tree::NonFinalizedTree"><code>NonFinalizedTree</code></a> type. This type is a data structure
containing a valid tree of block headers, plus the state necessary to verify new blocks with
the intent to add them to that tree. Each block header additionally holds a user-chosen
opaque data.</p>
<p>The state in the <a href="struct.NonFinalizedTree.html" title="struct smoldot::chain::blocks_tree::NonFinalizedTree"><code>NonFinalizedTree</code></a> consists of:</p>
<ul>
<li>One “latest finalized” block and various information about its ancestors, akin to a
<a href="../chain_information/struct.ChainInformation.html" title="struct smoldot::chain::chain_information::ChainInformation"><code>chain_information::ChainInformation</code></a>.</li>
<li>Zero or more blocks that descend from that latest finalized block.</li>
</ul>
<p>The latest finalized block is a block that is guaranteed to never be reverted. While it can
always be set to the genesis block of the chain, it is preferable, in order to reduce
memory utilization, to maintain it to a block that is as high as possible in the chain.</p>
<blockquote>
<p><strong>Note</strong>: While mechanisms such as GrandPa provide a network-wide way to designate a block
as final, the concept of GrandPa-provided finality doesn’t necessarily have to
match the concept of finality in the <a href="struct.NonFinalizedTree.html" title="struct smoldot::chain::blocks_tree::NonFinalizedTree"><code>NonFinalizedTree</code></a>. For example, an API
user might decide to optimistically assume that the block whose number is
<code>highest_block - 5</code> is automatically finalized, and fall back to rebuilding a new
<a href="struct.NonFinalizedTree.html" title="struct smoldot::chain::blocks_tree::NonFinalizedTree"><code>NonFinalizedTree</code></a> if that assumption turns out to not be true. The finalized
block in the <a href="struct.NonFinalizedTree.html" title="struct smoldot::chain::blocks_tree::NonFinalizedTree"><code>NonFinalizedTree</code></a> only represents a block that the
<a href="struct.NonFinalizedTree.html" title="struct smoldot::chain::blocks_tree::NonFinalizedTree"><code>NonFinalizedTree</code></a> itself cannot remove, not a block that cannot be removed in
the absolute.</p>
</blockquote>
<p>A block can be added to the chain by calling <a href="struct.NonFinalizedTree.html#method.verify_header" title="method smoldot::chain::blocks_tree::NonFinalizedTree::verify_header"><code>NonFinalizedTree::verify_header</code></a> or
<a href="struct.NonFinalizedTree.html#method.verify_body" title="method smoldot::chain::blocks_tree::NonFinalizedTree::verify_body"><code>NonFinalizedTree::verify_body</code></a>. As explained in details in
<a href="../../verify/index.html" title="mod smoldot::verify">the <code>verify</code> module</a>, verifying the header only verifies the authenticity of
a block and not its correctness. Verifying both the header and body provides the strongest
guarantee, but requires knowledge of the storage of the block that is parent of the block to
verify.</p>
<blockquote>
<p><strong>Note</strong>: There typically exists two kinds of clients: full and light. Full clients store
the state of the storage, while light clients don’t. For this reason, light
clients can only verify the header of new blocks. Both full and light clients
should wait for a block to be finalized if they want to be certain that it will
forever remain part of the chain.</p>
</blockquote>
<p>Additionally, a <a href="struct.NonFinalizedTree.html#method.verify_justification" title="method smoldot::chain::blocks_tree::NonFinalizedTree::verify_justification"><code>NonFinalizedTree::verify_justification</code></a> method is provided in order to
verify the correctness of a <a href="../../finality/justification/index.html" title="mod smoldot::finality::justification">justification</a>.</p>
</div></details><h2 id="reexports" class="small-section-header"><a href="#reexports">Re-exports</a></h2><ul class="item-table"><li><div class="item-name" id="reexport.Nibble"><code>pub use verify::header_body::<a class="struct" href="../../trie/proof_encode/struct.Nibble.html" title="struct smoldot::trie::proof_encode::Nibble">Nibble</a>;</code></div></li><li><div class="item-name" id="reexport.TrieEntryVersion"><code>pub use verify::header_body::<a class="enum" href="../../trie/enum.TrieEntryVersion.html" title="enum smoldot::trie::TrieEntryVersion">TrieEntryVersion</a>;</code></div></li></ul><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.BlockAccess.html" title="struct smoldot::chain::blocks_tree::BlockAccess">BlockAccess</a></div><div class="desc docblock-short">Access to a block’s information and hierarchy.</div></li><li><div class="item-name"><a class="struct" href="struct.BodyInsert.html" title="struct smoldot::chain::blocks_tree::BodyInsert">BodyInsert</a></div><div class="desc docblock-short">Holds the <a href="struct.NonFinalizedTree.html" title="struct smoldot::chain::blocks_tree::NonFinalizedTree"><code>NonFinalizedTree</code></a> and allows insert a successfully-verified block into it.</div></li><li><div class="item-name"><a class="struct" href="struct.BodyVerifyRuntimeRequired.html" title="struct smoldot::chain::blocks_tree::BodyVerifyRuntimeRequired">BodyVerifyRuntimeRequired</a></div><div class="desc docblock-short">Verification is pending. In order to continue, a <a href="../../executor/host/struct.HostVmPrototype.html" title="struct smoldot::executor::host::HostVmPrototype"><code>host::HostVmPrototype</code></a> of the runtime
of the parent block must be provided.</div></li><li><div class="item-name"><a class="struct" href="struct.Config.html" title="struct smoldot::chain::blocks_tree::Config">Config</a></div><div class="desc docblock-short">Configuration for the <a href="struct.NonFinalizedTree.html" title="struct smoldot::chain::blocks_tree::NonFinalizedTree"><code>NonFinalizedTree</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.FinalityApply.html" title="struct smoldot::chain::blocks_tree::FinalityApply">FinalityApply</a></div><div class="desc docblock-short">Returned by <a href="struct.NonFinalizedTree.html#method.verify_justification" title="method smoldot::chain::blocks_tree::NonFinalizedTree::verify_justification"><code>NonFinalizedTree::verify_justification</code></a> and
<a href="struct.NonFinalizedTree.html#method.verify_grandpa_commit_message" title="method smoldot::chain::blocks_tree::NonFinalizedTree::verify_grandpa_commit_message"><code>NonFinalizedTree::verify_grandpa_commit_message</code></a> on success.</div></li><li><div class="item-name"><a class="struct" href="struct.HeaderInsert.html" title="struct smoldot::chain::blocks_tree::HeaderInsert">HeaderInsert</a></div><div class="desc docblock-short">Mutably borrows the <a href="struct.NonFinalizedTree.html" title="struct smoldot::chain::blocks_tree::NonFinalizedTree"><code>NonFinalizedTree</code></a> and allows insert a successfully-verified block
into it.</div></li><li><div class="item-name"><a class="struct" href="struct.NonFinalizedTree.html" title="struct smoldot::chain::blocks_tree::NonFinalizedTree">NonFinalizedTree</a></div><div class="desc docblock-short">Holds state about the current state of the chain for the purpose of verifying headers.</div></li><li><div class="item-name"><a class="struct" href="struct.RuntimeCompilation.html" title="struct smoldot::chain::blocks_tree::RuntimeCompilation">RuntimeCompilation</a></div><div class="desc docblock-short">A new runtime must be compiled.</div></li><li><div class="item-name"><a class="struct" href="struct.SetFinalizedBlockIter.html" title="struct smoldot::chain::blocks_tree::SetFinalizedBlockIter">SetFinalizedBlockIter</a></div><div class="desc docblock-short">Iterator producing the newly-finalized blocks removed from the state when the finalized block
is updated.</div></li><li><div class="item-name"><a class="struct" href="struct.StorageClosestDescendantMerkleValue.html" title="struct smoldot::chain::blocks_tree::StorageClosestDescendantMerkleValue">StorageClosestDescendantMerkleValue</a></div><div class="desc docblock-short">Obtaining the Merkle value of the closest descendant of a trie node is required in order
to continue.</div></li><li><div class="item-name"><a class="struct" href="struct.StorageGet.html" title="struct smoldot::chain::blocks_tree::StorageGet">StorageGet</a></div><div class="desc docblock-short">Loading a storage value is required in order to continue.</div></li><li><div class="item-name"><a class="struct" href="struct.StorageNextKey.html" title="struct smoldot::chain::blocks_tree::StorageNextKey">StorageNextKey</a></div><div class="desc docblock-short">Fetching the key that follows a given one is required in order to continue.</div></li></ul><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.BodyVerifyError.html" title="enum smoldot::chain::blocks_tree::BodyVerifyError">BodyVerifyError</a></div><div class="desc docblock-short">Error while verifying a block body.</div></li><li><div class="item-name"><a class="enum" href="enum.BodyVerifyStep1.html" title="enum smoldot::chain::blocks_tree::BodyVerifyStep1">BodyVerifyStep1</a></div><div class="desc docblock-short">Block verification, either just finished or still in progress.</div></li><li><div class="item-name"><a class="enum" href="enum.BodyVerifyStep2.html" title="enum smoldot::chain::blocks_tree::BodyVerifyStep2">BodyVerifyStep2</a></div><div class="desc docblock-short">Block verification, either just finished or still in progress.</div></li><li><div class="item-name"><a class="enum" href="enum.CommitVerifyError.html" title="enum smoldot::chain::blocks_tree::CommitVerifyError">CommitVerifyError</a></div><div class="desc docblock-short">Error that can happen when verifying a Grandpa commit.</div></li><li><div class="item-name"><a class="enum" href="enum.FinalityVerifyError.html" title="enum smoldot::chain::blocks_tree::FinalityVerifyError">FinalityVerifyError</a></div><div class="desc docblock-short">Error that can happen when verifying a proof of finality.</div></li><li><div class="item-name"><a class="enum" href="enum.HeaderVerifyError.html" title="enum smoldot::chain::blocks_tree::HeaderVerifyError">HeaderVerifyError</a></div><div class="desc docblock-short">Error that can happen when verifying a block header.</div></li><li><div class="item-name"><a class="enum" href="enum.HeaderVerifySuccess.html" title="enum smoldot::chain::blocks_tree::HeaderVerifySuccess">HeaderVerifySuccess</a></div></li><li><div class="item-name"><a class="enum" href="enum.JustificationVerifyError.html" title="enum smoldot::chain::blocks_tree::JustificationVerifyError">JustificationVerifyError</a></div><div class="desc docblock-short">Error that can happen when verifying a justification.</div></li><li><div class="item-name"><a class="enum" href="enum.SetFinalizedError.html" title="enum smoldot::chain::blocks_tree::SetFinalizedError">SetFinalizedError</a></div><div class="desc docblock-short">Error that can happen when setting the finalized block.</div></li></ul></section></div></main></body></html>