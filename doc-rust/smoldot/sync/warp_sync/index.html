<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Warp syncing."><title>smoldot::sync::warp_sync - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-ba5701c5741a7b69.css" id="mainThemeStyle"><div id="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="smoldot" data-themes="" data-resource-suffix="" data-rustdoc-version="1.70.0 (90c541806 2023-05-31)" data-search-js="search-e077946657036a58.js" data-settings-js="settings-298e1ea74db45b39.js" data-settings-css="settings-7bfb4c59cc6bc502.css" data-theme-light-css="light-0f8c037637f9eb3e.css" data-theme-dark-css="dark-1097f8e92a01e3cf.css" data-theme-ayu-css="ayu-614652228113ac93.css" ></div><script src="../../../static.files/storage-62ce34ea385b278a.js"></script><script defer src="../../../static.files/main-f61008743c98d196.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../../../static.files/light-0f8c037637f9eb3e.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../../../static.files/dark-1097f8e92a01e3cf.css"><link rel="stylesheet" href="../../../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../../smoldot/index.html"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../../smoldot/index.html"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Module warp_sync</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#reexports">Re-exports</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#functions">Functions</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../../index.html">smoldot</a>::<wbr><a href="../index.html">sync</a>::<wbr><a class="mod" href="#">warp_sync</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../../src/smoldot/sync/warp_sync.rs.html#18-1559">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Warp syncing.</p>
<p>Warp syncing makes it possible to very quickly reach the currently finalized block of a chain.
No attempt is made at verifying blocks. The algorithm assumes that the currently finalized
block is valid, as the chain is likely bricked if this is not the case.</p>
<h2 id="long-range-attack-vulnerability"><a href="#long-range-attack-vulnerability">Long range attack vulnerability</a></h2>
<p>Warp syncing is particularly vulnerable to what is called long range attacks.</p>
<p>The authorities allowed to finalize blocks can generate multiple proofs of finality for
multiple different blocks of the same height. In other words, they can finalize more than one
chain at a time.</p>
<p>Finalizing multiple chains at the same time is called an equivocation. Client implementations
detect equivocations and report them to the runtime. While this is out of scope of the client,
the runtime then typically provides a mechanism that punishes the validators that have
equivocated.
However, this defense mechanism is flawed in case when a long time passes between the
multiple finality proofs generated by the same validators. Clients cannot hold an unlimited
amount of information in memory, so they might not detect the equivocation, and even if it is
detected, the punishment might not be enforceable because validators have moved all their
funds.</p>
<p>In other words, it is possible for two thirds of the validators that were active at a certain
past block N to collude and decide to finalize a different block N, even when N has been
finalized for the first time several weeks or months in the past. When a client then warp
syncs, it can be tricked to consider this alternative block N as the finalized one.</p>
<p>There is no fool-proof defense against this attack. However, consider the extremely high
investment and high risk for the malicious validators, and the difficulty of pulling off this
attack, it is extremely unlikely to happen in reality.
The aforementioned punishment system is the only defense against this attack, and in order to
be effective, the starting point of the warp syncing shouldn’t be too far in the past. How
far exactly depends on the logic of the runtime of the chain.</p>
<h2 id="overview"><a href="#overview">Overview</a></h2>
<p>The warp syncing algorithm works only if the chain uses Grandpa for its finality.
It consists in the following steps:</p>
<ul>
<li>Downloading a warp sync proof from a source. This proof contains a list of <em>fragments</em>. Each
fragment represents a change in the list of Grandpa authorities, and a list of signatures of
the previous authorities that certify that this change is correct.</li>
<li>Verifying the fragments. Each fragment that is successfully verified progresses towards
the head of the chain. Even if one fragment is invalid, all the previously-verified
fragments can still be kept, and the warp syncing can resume from there.</li>
<li>Downloading from a source the runtime code of the final block of the proof.</li>
<li>Performing some runtime calls in order to obtain the current consensus-related parameters
of the chain. This might require obtaining some storage items, in which case they must also
be downloaded from a source.</li>
</ul>
<p>At the end of the syncing, a <a href="../../chain/chain_information/struct.ValidChainInformation.html" title="struct smoldot::chain::chain_information::ValidChainInformation"><code>ValidChainInformation</code></a> corresponding to the head of the chain
is yielded.</p>
<h2 id="usage"><a href="#usage">Usage</a></h2>
<p>Use the <a href="fn.start_warp_sync.html" title="fn smoldot::sync::warp_sync::start_warp_sync"><code>start_warp_sync()</code></a> function to start a Grandpa warp syncing state machine.</p>
<p>At any given moment, this state machine holds a list of <em>sources</em> that it might use to
download the warp sync proof or the runtime code. Sources must be added and removed by the API
user by calling one of the various <code>add_source</code> and <code>remove_source</code> functions.</p>
<p>Sources are identified through a <a href="struct.SourceId.html" title="struct smoldot::sync::warp_sync::SourceId"><code>SourceId</code></a>. Each source has an opaque so-called “user data”
of type <code>TSrc</code> associated to it. The content of this “user data” is at the discretion of the
API user.</p>
<p>Similarly, at any given moment, this state machine holds a list of requests that concern these
sources. Use <a href="struct.InProgressWarpSync.html#method.desired_requests" title="method smoldot::sync::warp_sync::InProgressWarpSync::desired_requests"><code>InProgressWarpSync::desired_requests</code></a> to determine which requests will be
useful to the progress of the warp syncing, then use <a href="struct.InProgressWarpSync.html#method.add_request" title="method smoldot::sync::warp_sync::InProgressWarpSync::add_request"><code>InProgressWarpSync::add_request</code></a> to
update the state machine with a newly-started request.</p>
<p>Use <a href="struct.InProgressWarpSync.html#method.process_one" title="method smoldot::sync::warp_sync::InProgressWarpSync::process_one"><code>InProgressWarpSync::process_one</code></a> in order to run verifications of the payloads that have
previously been downloaded.</p>
</div></details><h2 id="reexports" class="small-section-header"><a href="#reexports">Re-exports</a></h2><ul class="item-table"><li><div class="item-name" id="reexport.FragmentError"><code>pub use warp_sync::<a class="enum" href="../../finality/grandpa/warp_sync/enum.Error.html" title="enum smoldot::finality::grandpa::warp_sync::Error">Error</a> as FragmentError;</code></div></li><li><div class="item-name" id="reexport.WarpSyncFragment"><code>pub use warp_sync::<a class="struct" href="../../finality/grandpa/warp_sync/struct.WarpSyncFragment.html" title="struct smoldot::finality::grandpa::warp_sync::WarpSyncFragment">WarpSyncFragment</a>;</code></div></li></ul><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.BuildChainInformation.html" title="struct smoldot::sync::warp_sync::BuildChainInformation">BuildChainInformation</a></div><div class="desc docblock-short">Ready to verify the parameters of the chain against the finalized block.</div></li><li><div class="item-name"><a class="struct" href="struct.BuildRuntime.html" title="struct smoldot::sync::warp_sync::BuildRuntime">BuildRuntime</a></div><div class="desc docblock-short">Ready to build the runtime of the finalized chain.</div></li><li><div class="item-name"><a class="struct" href="struct.Config.html" title="struct smoldot::sync::warp_sync::Config">Config</a></div><div class="desc docblock-short">The configuration for <a href="fn.start_warp_sync.html" title="fn smoldot::sync::warp_sync::start_warp_sync"><code>start_warp_sync()</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.InProgressWarpSync.html" title="struct smoldot::sync::warp_sync::InProgressWarpSync">InProgressWarpSync</a></div><div class="desc docblock-short">Warp syncing process now obtaining the chain information.</div></li><li><div class="item-name"><a class="struct" href="struct.RequestId.html" title="struct smoldot::sync::warp_sync::RequestId">RequestId</a></div><div class="desc docblock-short">Identifier for a request in the warp sync state machine.</div></li><li><div class="item-name"><a class="struct" href="struct.SourceId.html" title="struct smoldot::sync::warp_sync::SourceId">SourceId</a></div><div class="desc docblock-short">Identifier for a source in the <a href="enum.WarpSync.html" title="enum smoldot::sync::warp_sync::WarpSync"><code>WarpSync</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.Success.html" title="struct smoldot::sync::warp_sync::Success">Success</a></div><div class="desc docblock-short">The result of a successful warp sync.</div></li><li><div class="item-name"><a class="struct" href="struct.VerifyWarpSyncFragment.html" title="struct smoldot::sync::warp_sync::VerifyWarpSyncFragment">VerifyWarpSyncFragment</a></div><div class="desc docblock-short">Ready to verify a warp sync fragment.</div></li></ul><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.DesiredRequest.html" title="enum smoldot::sync::warp_sync::DesiredRequest">DesiredRequest</a></div><div class="desc docblock-short">Information about a request that the warp sync state machine would like to start.</div></li><li><div class="item-name"><a class="enum" href="enum.Error.html" title="enum smoldot::sync::warp_sync::Error">Error</a></div><div class="desc docblock-short">Problem encountered during a call to <a href="fn.start_warp_sync.html" title="fn smoldot::sync::warp_sync::start_warp_sync"><code>start_warp_sync()</code></a>.</div></li><li><div class="item-name"><a class="enum" href="enum.ProcessOne.html" title="enum smoldot::sync::warp_sync::ProcessOne">ProcessOne</a></div><div class="desc docblock-short">Return value of <a href="struct.InProgressWarpSync.html#method.process_one" title="method smoldot::sync::warp_sync::InProgressWarpSync::process_one"><code>InProgressWarpSync::process_one</code></a>.</div></li><li><div class="item-name"><a class="enum" href="enum.RequestDetail.html" title="enum smoldot::sync::warp_sync::RequestDetail">RequestDetail</a></div><div class="desc docblock-short">Information about a request to add to the state machine.</div></li><li><div class="item-name"><a class="enum" href="enum.Status.html" title="enum smoldot::sync::warp_sync::Status">Status</a></div><div class="desc docblock-short">See <a href="struct.InProgressWarpSync.html#method.status" title="method smoldot::sync::warp_sync::InProgressWarpSync::status"><code>InProgressWarpSync::status</code></a>.</div></li><li><div class="item-name"><a class="enum" href="enum.WarpSync.html" title="enum smoldot::sync::warp_sync::WarpSync">WarpSync</a></div><div class="desc docblock-short">The warp sync state machine.</div></li><li><div class="item-name"><a class="enum" href="enum.WarpSyncInitError.html" title="enum smoldot::sync::warp_sync::WarpSyncInitError">WarpSyncInitError</a></div><div class="desc docblock-short">Error potentially returned by <a href="fn.start_warp_sync.html" title="fn smoldot::sync::warp_sync::start_warp_sync"><code>start_warp_sync()</code></a>.</div></li></ul><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.start_warp_sync.html" title="fn smoldot::sync::warp_sync::start_warp_sync">start_warp_sync</a></div><div class="desc docblock-short">Initializes the warp sync state machine.</div></li></ul></section></div></main></body></html>